<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Empleadores ‚Äî Capacitaci√≥n en Alturas</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0a0f1a; --panel:#0f1726; --card:#121c2f; --muted:#9fb0c3; --text:#eaf2ff;
      --stroke:#22324b; --brand1:#2dd4bf; --brand2:#3b82f6; --ok:#22c55e; --bad:#ef4444; --radius:16px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:
      radial-gradient(1200px 600px at 10% -10%, rgba(59,130,246,.18), transparent 60%),
      radial-gradient(900px 500px at 110% 10%, rgba(45,212,191,.15), transparent 55%),
      var(--bg); color:var(--text); line-height:1.6}
    .wrap{max-width:1100px;margin:0 auto;padding:1rem 1.25rem 2rem}
    header{position:sticky;top:0;z-index:10;backdrop-filter:blur(10px);
      background:linear-gradient(180deg, rgba(6,10,18,.75), rgba(6,10,18,.3));
      border-bottom:1px solid rgba(147,197,253,.12)}
    .top{display:flex;justify-content:space-between;align-items:center;gap:1rem;
      background:linear-gradient(180deg, rgba(18,28,47,.7), rgba(18,28,47,.3));
      border:1px solid var(--stroke); padding:.9rem 1rem; border-radius:14px}
    .progressbar{width:100%;height:8px;background:#0c1526;border-radius:999px;overflow:hidden;margin-top:.5rem}
    .progressbar>span{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--brand1),var(--brand2));transition:width .3s ease}
    .hud{display:flex;gap:1rem;color:#cfe2ff;flex-wrap:wrap}
    .pill{background:#10213a;border:1px solid #2a4269;border-radius:999px;padding:.2rem .6rem;font-size:.85rem}
    .card{margin-top:1rem;background:var(--panel);border:1px solid var(--stroke);border-radius:var(--radius);padding:1.1rem;box-shadow:0 10px 24px rgba(0,0,0,.25)}
    .title{margin:.2rem 0 .1rem;font-size:clamp(1.2rem,2.6vw,1.6rem);font-weight:800}
    .subtitle{margin:0 0 .8rem;color:var(--muted);font-size:1rem}
    .options{display:grid;gap:.6rem;margin:1rem 0}
    .opt{display:flex;gap:.6rem;align-items:flex-start;padding:.7rem .8rem;background:#0e1a2c;border:1px solid #20324f;border-radius:12px;cursor:pointer;transition:all .2s ease;text-align:left}
    .opt:hover{border-color:#3a5e90;background:#10233e}
    .opt input{margin-top:.1rem;cursor:pointer}
    .opt.disabled{opacity:.6;cursor:not-allowed}
    .opt.correct{background:#10442f;border-color:var(--ok)}
    .opt.wrong{background:#3a1a1a;border-color:var(--bad)}
    .actions{display:flex;gap:.6rem;margin-top:1rem;flex-wrap:wrap}
    .btn{border:none;border-radius:12px;padding:.6rem .95rem;cursor:pointer;font-weight:800;font-size:.95rem}
    .btn.primary{background:linear-gradient(90deg,var(--brand1),var(--brand2));color:#081018}
    .btn.secondary{background:#12233e;color:#cae0ff;border:1px solid #2a4269}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .btn:hover:not(:disabled){transform:translateY(-1px)}
    .feedback{margin-top:.9rem;border-left:4px solid #2a4269;background:#0f1c30;border-radius:10px;padding:.65rem .8rem;display:none}
    .feedback.show{display:block}
    .feedback.ok{border-left-color:var(--ok)}
    .feedback.bad{border-left-color:var(--bad)}
    .feedback h4{margin:0 0 .5rem;font-size:1.1rem}
    .feedback h4.ok{color:var(--ok)}
    .feedback h4.bad{color:var(--bad)}
    .feedback p{margin:.3rem 0;color:var(--muted)}
    .impact{background:rgba(59,130,246,.1);border-left:3px solid var(--brand2);padding:.6rem;border-radius:8px;margin:.8rem 0}
    .media{margin-top:.8rem}
    .media video,.media img{width:100%;border-radius:12px;max-height:360px;object-fit:contain;background:#000}
    .media-image{cursor:zoom-in}
    .media-actions{display:flex;gap:.5rem;margin-top:.5rem}
    .btn.ghost{background:transparent;border:1px solid #2a4269;color:#cfe2ff;padding:.3rem .6rem;border-radius:10px;font-weight:700;font-size:.85rem}
    .results{display:none;margin-top:1rem;background:var(--panel);border:1px solid var(--stroke);border-radius:var(--radius);padding:1.1rem}
    .results h2{margin:.2rem 0 .6rem;font-size:1.4rem}
    .grid2{display:grid;gap:.6rem;grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
    .metric{background:#0e1a2c;border:1px solid #20324f;border-radius:12px;padding:.8rem}
    .metric .big{font-size:1.6rem;font-weight:800}
    #imgModal{position:fixed;inset:0;background:rgba(0,0,0,.85);display:none;align-items:center;justify-content:center;z-index:9999;padding:2rem}
    #imgModal img{max-width:100%;max-height:100%;object-fit:contain;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.45)}
    #imgModal .close{position:absolute;top:16px;right:16px;background:#0f1c30;border:1px solid #2a4269;color:#eaf2ff;padding:.45rem .7rem;border-radius:10px;font-weight:800;cursor:pointer}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="top">
        <div>
          <div style="display:flex;gap:.6rem;align-items:center;color:#cfe2ff">
            <strong id="qCounter">Pregunta 1/19</strong>
            <span class="pill" id="scorePill">Puntaje: 0</span>
            <span class="pill" id="skipsPill">Saltadas: 0</span>
          </div>
          <div class="progressbar"><span id="progressFill"></span></div>
        </div>
        <div class="hud"><span class="pill">M√≥dulo: Empleadores</span></div>
      </div>
    </div>
  </header>

  <main class="wrap">
    <section class="card" id="qCard">
      <h2 class="title" id="qTitle">T√≠tulo</h2>
      <p class="subtitle" id="qSubtitle">Enunciado</p>
      <form class="options" id="optForm"></form>
      <div class="actions">
        <button class="btn secondary" id="skipBtn" type="button">Saltar</button>
        <button class="btn primary" id="nextBtn" type="button">Siguiente</button>
      </div>
      <div id="feedback" class="feedback"></div>
      <video id="qVideo" controls preload="metadata" style="display:none;width:100%;max-height:360px;border-radius:12px;margin-top:.6rem;background:#000"></video>
      <div id="imgWrap" style="display:none;margin-top:.6rem">
        <img id="qImage" alt="Feedback visual" style="width:100%;max-height:360px;border-radius:12px;object-fit:contain;cursor:zoom-in;background:#000">
        <div class="media-actions">
          <button class="btn ghost" type="button" id="openFullBtn">Ver completa</button>
          <a class="btn ghost" id="downloadImg" href="#" download>Descargar</a>
        </div>
      </div>
    </section>

    <section class="results" id="results">
      <h2>Resultados del m√≥dulo</h2>
      <div class="grid2">
        <div class="metric"><div>Respuestas correctas</div><div class="big" id="mCorrect">0</div></div>
        <div class="metric"><div>Respuestas incorrectas</div><div class="big" id="mWrong">0</div></div>
        <div class="metric"><div>Preguntas saltadas</div><div class="big" id="mSkipped">0</div></div>
        <div class="metric"><div>% de capacitaci√≥n</div><div class="big" id="mPercent">0%</div></div>
      </div>
      <p style="color:var(--muted);margin-top:.8rem" id="mHint"></p>

      <div id="formNombre" style="margin-top:1.5rem;padding:1rem;background:#0e1a2c;border:1px solid #20324f;border-radius:12px">
        <label for="nombreUsuario" style="display:block;margin-bottom:.5rem;font-weight:600;color:#eaf2ff">
          üíæ Ingresa tu nombre para guardar tu resultado:
        </label>
        <input type="text" id="nombreUsuario" placeholder="Tu nombre completo" maxlength="100"
          style="width:100%;padding:.6rem;border-radius:8px;border:1px solid #2a4269;background:#0b1328;color:#eaf2ff;font-size:1rem;margin-bottom:.7rem"/>
        <button onclick="guardarResultadoSupabase()" class="btn primary" style="width:100%">üíæ Guardar Resultado</button>
      </div>

      <div id="mensajeGuardado" style="display:none;margin-top:1rem;padding:.8rem;background:#10b981;color:#fff;border-radius:8px;text-align:center;font-weight:700"></div>

      <div class="actions" style="margin-top:1rem">
        <button class="btn primary" type="button" id="restartBtn">Reiniciar m√≥dulo</button>
        <a class="btn secondary" href="empleados.html">Volver a Empleados</a>
      </div>
    </section>
  </main>

  <div id="imgModal">
    <button class="close" id="closeModal" type="button">Cerrar √ó</button>
    <img id="modalImg" alt="Imagen completa">
  </div>

  <script>
    function shuffle(a){ const r=a.slice(); for(let i=r.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[r[i],r[j]]=[r[j],r[i]];} return r; }

    const questions = [
      {
        title: "Costo de un accidente en altura",
        subtitle: "¬øCu√°nto podr√≠a costar a la empresa un accidente en altura, considerando atenci√≥n m√©dica, demandas y compensaciones?",
        media: { ok: "empleadores1.jpg", bad: "empleadores1.jpg" },
        options: [
          { text:"Menos de 1000 Bs.", feedbackIncorrect:"Subestimar costos ignora gastos legales y paralizaci√≥n de obra." },
          { text:"Entre 1000 y 2,000 Bs.", feedbackIncorrect:"Incluso un accidente leve puede superar esos montos." },
          { text:"Entre 5,000 y 10,000 Bs.", feedbackIncorrect:"Accidentes graves pueden superar ampliamente ese rango." },
          { text:"M√°s de 10,000 Bs.", correct:true, feedbackCorrect:"Algunos accidentes graves superan 10,000 Bs solo en gastos directos; faltan los indirectos." }
        ],
        companyImpact: { wrong:"Falsa sensaci√≥n de ahorro; se omiten demandas, multas y paros.", right:"Mejor estimaci√≥n para planificar prevenci√≥n y seguros." }
      },
      {
        title: "Impacto en plazos de entrega",
        subtitle: "¬øCu√°les son los efectos de un accidente en altura en los plazos de la obra?",
        media: { ok: "empleadores2.png", bad: "empleadores2.png" },
        options: [
          { text:"No afecta los plazos.", feedbackIncorrect:"Ignora peritajes, investigaci√≥n y paradas obligatorias." },
          { text:"Puede retrasar unas semanas.", feedbackIncorrect:"Puede ser peor seg√∫n la gravedad." },
          { text:"Puede retrasar meses o incluso cancelarlo.", correct:true, feedbackCorrect:"Un evento grave puede suspender o paralizar el proyecto." },
          { text:"Solo afecta la moral del equipo.", feedbackIncorrect:"Tambi√©n impacta cronogramas y entregables." }
        ],
        companyImpact:{ wrong:"Mala planificaci√≥n de cronograma y penalidades.", right:"Plan de contingencia realista." }
      },
      {
        title: "Falta de capacitaci√≥n y costos operativos",
        subtitle: "¬øQu√© impacto econ√≥mico tiene la falta de capacitaci√≥n en seguridad?",
        media: { ok: "empleadores3.png", bad: "empleadores4.png" },
        options: [
          { text:"No tiene impacto.", feedbackIncorrect:"Aumenta incidentes y errores." },
          { text:"Aumenta costos por reemplazos/ausencias.", correct:true, feedbackCorrect:"Faltas, reemplazos y curva de aprendizaje elevan costos." },
          { text:"Solo a corto plazo.", feedbackIncorrect:"Tambi√©n hay costos acumulativos y reputacionales." },
          { text:"Solo si ocurre un accidente grave.", feedbackIncorrect:"Los accidentes menores tambi√©n suman costos." }
        ],
        companyImpact:{ wrong:"Presupuesto irreal y sin prevenci√≥n.", right:"Optimiza costos operativos con formaci√≥n." }
      },
      {
        title: "Reputaci√≥n por falta de capacitaci√≥n",
        subtitle: "¬øQu√© efecto tiene un accidente por falta de capacitaci√≥n en la reputaci√≥n?",
        media: { ok: "empleadores6.png", bad: "empleadores6.png" },
        options: [
          { text:"No afecta la reputaci√≥n.", feedbackIncorrect:"Riesgo de perder contratos y confianza." },
          { text:"Mejora por asumir riesgos.", feedbackIncorrect:"Normalizar riesgo genera desconfianza." },
          { text:"Se ve negativamente afectada.", correct:true, feedbackCorrect:"Clientes/contratistas evitan empresas inseguras." },
          { text:"No afecta si se paga compensaci√≥n.", feedbackIncorrect:"La imagen se deteriora igual a largo plazo." }
        ],
        companyImpact:{ wrong:"Menor competitividad en licitaciones.", right:"Mejores relaciones y preferencia de clientes." }
      },
      {
        title: "Opci√≥n m√°s rentable a largo plazo",
        subtitle: "¬øQu√© opci√≥n es m√°s rentable para evitar accidentes en altura?",
        media: { ok: "empleadores7.png", bad: "empleadores8.mp4" },
        options: [
          { text:"Evitar capacitaci√≥n y confiar en experiencia.", feedbackIncorrect:"La experiencia sin norma no evita accidentes." },
          { text:"Capacitaci√≥n peri√≥dica + equipos adecuados.", correct:true, feedbackCorrect:"Reduce frecuencia y gravedad de incidentes." },
          { text:"Capacitar solo el primer mes.", feedbackIncorrect:"Se requiere refuerzo continuo." },
          { text:"Solo capacitar a supervisores.", feedbackIncorrect:"Todo el personal debe conocer medidas." }
        ],
        companyImpact:{ wrong:"Riesgo sostenido y costos crecientes.", right:"Menos siniestralidad y primas de seguro." }
      },
      {
        title: "Consecuencia legal (Ley Boliviana)",
        subtitle: "¬øPrincipal consecuencia econ√≥mica por incumplir seguridad en altura?",
        media: { ok: "empleadores10.png", bad: "empleadores10.png" },
        options: [
          { text:"Solo sanciones menores.", feedbackIncorrect:"Pueden ser severas y paralizar la obra." },
          { text:"Multas y posible paralizaci√≥n de obra.", correct:true, feedbackCorrect:"La ley prev√© multas y suspensi√≥n." },
          { text:"Sin consecuencias legales.", feedbackIncorrect:"S√≠ existen consecuencias legales y econ√≥micas." },
          { text:"Solo reporte sin sanciones.", feedbackIncorrect:"Hay sanciones y medidas correctivas." }
        ],
        companyImpact:{ wrong:"Exposici√≥n legal y financiera.", right:"Cumplimiento evita p√©rdidas mayores." }
      },
      {
        title: "Impacto en PYMES",
        subtitle: "Sin capacitaci√≥n adecuada, ¬øqu√© enfrentan las empresas peque√±as?",
        media: { ok: "empleadores11.png", bad: "empleadores12.mp4" },
        options: [
          { text:"Ninguna consecuencia.", feedbackIncorrect:"Multas y demandas son cr√≠ticas." },
          { text:"Problemas financieros y p√©rdida de contratos.", correct:true, feedbackCorrect:"Compensaciones pueden quebrar a una PyME." },
          { text:"Sale adelante con costo inicial.", feedbackIncorrect:"Los costos se acumulan." },
          { text:"Solo pierde imagen.", feedbackIncorrect:"Tambi√©n hay impacto econ√≥mico." }
        ],
        companyImpact:{ wrong:"Supone resiliencia inexistente.", right:"Prevenci√≥n protege liquidez." }
      },
      {
        title: "Accidente grave sin capacitaci√≥n",
        subtitle: "Si la empresa no capacit√≥ adecuadamente y ocurre accidente grave...",
        media: { ok: "empleadores13.mp4", bad: "empleadores14.mp4" },
        options: [
          { text:"Compensaci√≥n m√≠nima y sigue la obra.", feedbackIncorrect:"Puede suspenderse y perder contratos." },
          { text:"Suspensi√≥n, indemnizaciones y p√©rdida de contrato.", correct:true, feedbackCorrect:"Consecuencia t√≠pica por negligencia." },
          { text:"Empresa no paga por error humano.", feedbackIncorrect:"Hay responsabilidad legal." },
          { text:"No hay afectaci√≥n financiera significativa.", feedbackIncorrect:"Impacto alto en caja y reputaci√≥n." }
        ],
        companyImpact:{ wrong:"Riesgo legal subestimado.", right:"Pol√≠tica de Cero Accidentes viable." }
      },
      {
        title: "Suspensi√≥n de obra por incumplimiento",
        subtitle: "¬øPuede una obra suspenderse por no cumplir normas de seguridad?",
        media: { ok: "empleadores16.png", bad: "empleadores16.png" },
        options: [
          { text:"Solo si el accidente es muy grave.", feedbackIncorrect:"Tambi√©n por infracciones." },
          { text:"No ocurre en la pr√°ctica.", feedbackIncorrect:"S√≠ ocurre y afecta flujo." },
          { text:"S√≠, es un riesgo considerable.", correct:true, feedbackCorrect:"Paradas afectan econom√≠a y confianza." },
          { text:"Nunca se suspenden obras por eso.", feedbackIncorrect:"Cumplimiento es obligatorio." }
        ],
        companyImpact:{ wrong:"Ignora el riesgo regulatorio.", right:"Mejores controles de cumplimiento." }
      },
      {
        title: "Paralizaci√≥n y costos operativos",
        subtitle: "Si la obra se paraliza por falta de seguridad, ¬øimpacto econ√≥mico?",
        media: { ok: "empleadores17.mp4", bad: "empleadores18.mp4" },
        options: [
          { text:"Sin impacto, la obra sigue.", feedbackIncorrect:"Paros elevan costos." },
          { text:"Meses detenida: sube costos y salarios.", correct:true, feedbackCorrect:"Grandes p√©rdidas por inactividad." },
          { text:"Solo tiempo, no costos.", feedbackIncorrect:"Tiempo = costo en obra." },
          { text:"Costos bajos, sin impacto.", feedbackIncorrect:"Flujo de caja comprometido." }
        ],
        companyImpact:{ wrong:"Errores de presupuesto.", right:"Planes de contingencia reales." }
      },
      {
        title: "Clima laboral y productividad",
        subtitle: "¬øC√≥mo afecta baja capacitaci√≥n al clima laboral y productividad?",
        media: { ok: "empleadores19.mp4", bad: "empleadores19.mp4" },
        options: [
          { text:"No afecta.", feedbackIncorrect:"Genera inseguridad y estr√©s." },
          { text:"Estr√©s/desconfianza y menor eficiencia.", correct:true, feedbackCorrect:"M√°s rotaci√≥n y errores." },
          { text:"Solo corto plazo.", feedbackIncorrect:"Efectos pueden persistir." },
          { text:"Mejora ambiente por menos reglas.", feedbackIncorrect:"Sin seguridad, peor clima." }
        ],
        companyImpact:{ wrong:"Ignora factor humano.", right:"Mejor retenci√≥n y desempe√±o." }
      },
      {
        title: "Primas de seguro",
        subtitle: "Impacto de baja capacitaci√≥n en primas de seguros:",
        media: { ok: "empleadores22.mp4", bad: "empleadores22.mp4" },
        options: [
          { text:"No afecta: hay seguro.", feedbackIncorrect:"Mayor riesgo = primas m√°s altas." },
          { text:"Aumentan significativamente.", correct:true, feedbackCorrect:"Historial de siniestros encarece p√≥lizas." },
          { text:"Disminuyen si no hay accidentes.", feedbackIncorrect:"Riesgo percibido pesa m√°s." },
          { text:"No se ven afectadas.", feedbackIncorrect:"La capacitaci√≥n s√≠ impacta." }
        ],
        companyImpact:{ wrong:"Costos financieros invisibles.", right:"Ahorro en seguros a largo plazo." }
      },
      {
        title: "Productividad a largo plazo",
        subtitle: "Sin invertir en capacitaci√≥n, la productividad a largo plazo...",
        media: { ok: "empleadores24.mp4", bad: "empleadores24.mp4" },
        options: [
          { text:"No cambia.", feedbackIncorrect:"M√°s incidentes bajan rendimiento." },
          { text:"Puede disminuir (moral/rotaci√≥n).", correct:true, feedbackCorrect:"Ambiente inseguro reduce eficiencia." },
          { text:"Aumenta por confianza.", feedbackIncorrect:"Sin seguridad no hay confianza." },
          { text:"Solo si hay accidente grave.", feedbackIncorrect:"Acumulado de incidentes afecta." }
        ],
        companyImpact:{ wrong:"Plan de producci√≥n irreal.", right:"Estabilidad operativa." }
      },
      {
        title: "Reducir costos a largo plazo",
        subtitle: "¬øQu√© debe hacer la empresa para reducir costos por accidentes?",
        media: { ok: "empleadores25.mp4", bad: "empleadores26.mp4" },
        options: [
          { text:"Nada, no son frecuentes.", feedbackIncorrect:"Un solo evento puede ser cr√≠tico." },
          { text:"Capacitaci√≥n continua + protocolos.", correct:true, feedbackCorrect:"Previene, estandariza y baja costos." },
          { text:"Solo contratar con experiencia.", feedbackIncorrect:"Se requiere actualizaci√≥n normativa." },
          { text:"Reducir salarios.", feedbackIncorrect:"No soluciona el riesgo ni el costo." }
        ],
        companyImpact:{ wrong:"Corta de vista de riesgos.", right:"Menos indemnizaciones y multas." }
      },
      {
        title: "Capacitaci√≥n a supervisores",
        subtitle: "Riesgo de no capacitar a supervisores que controlan altura:",
        media: { ok: "empleadores27.mp4", bad: "empleadores28.mp4" },
        options: [
          { text:"No impacta seguridad.", feedbackIncorrect:"Son clave en la prevenci√≥n." },
          { text:"No detectan riesgos: m√°s accidentes.", correct:true, feedbackCorrect:"Fallas de control elevan siniestralidad." },
          { text:"Solo administrativos.", feedbackIncorrect:"Tambi√©n garantizan cumplimiento." },
          { text:"No hay riesgo, todos obedecen.", feedbackIncorrect:"Se requiere supervisi√≥n efectiva." }
        ],
        companyImpact:{ wrong:"Liderazgo d√©bil en seguridad.", right:"Cultura preventiva real." }
      },
      {
        title: "Licitaciones y seguridad",
        subtitle: "¬øC√≥mo impacta no cumplir medidas de seguridad en licitaciones?",
        media: { ok: "empleadores29.mp4", bad: "empleadores30.mp4" },
        options: [
          { text:"Da m√°s oportunidades.", feedbackIncorrect:"Reputaci√≥n y puntaje bajan." },
          { text:"No se ven afectadas.", feedbackIncorrect:"La seguridad es criterio clave." },
          { text:"Menos posibilidades de ganar.", correct:true, feedbackCorrect:"Costos y riesgos penalizan la oferta." },
          { text:"Es m√°s f√°cil ganar sin seguridad.", feedbackIncorrect:"Oferta se vuelve no competitiva." }
        ],
        companyImpact:{ wrong:"Estrategia comercial deficiente.", right:"Mejores puntajes t√©cnicos." }
      },
      {
        title: "No proporcionar EPP adecuados",
        subtitle: "Impacto econ√≥mico de no dotar EPP adecuados:",
        media: { ok: "empleadores31.mp4", bad: "empleadores32.mp4" },
        options: [
          { text:"Ninguno.", feedbackIncorrect:"Riesgo legal y de seguros." },
          { text:"Sanciones y primas m√°s altas.", correct:true, feedbackCorrect:"Incumplir encarece la operaci√≥n." },
          { text:"Solo moral del trabajador.", feedbackIncorrect:"Tambi√©n finanzas y continuidad." },
          { text:"Son opcionales.", feedbackIncorrect:"Son obligatorios por norma." }
        ],
        companyImpact:{ wrong:"Costos ocultos progresivos.", right:"Cumplimiento y menores primas." }
      },
      {
        title: "Herramientas adecuadas",
        subtitle: "Falta de herramientas adecuadas para altura puede‚Ä¶",
        media: { ok: "empleadores34.mp4", bad: "empleadores34.mp4" },
        options: [
          { text:"Solo m√°s tiempo.", feedbackIncorrect:"Incrementa accidentes y paradas." },
          { text:"Causar accidentes y multas.", correct:true, feedbackCorrect:"Deriva en paros y compensaciones." },
          { text:"Sin impacto: se consigue luego.", feedbackIncorrect:"Improvisar eleva el riesgo." },
          { text:"Solo baja calidad.", feedbackIncorrect:"Tambi√©n afecta econom√≠a." }
        ],
        companyImpact:{ wrong:"Productividad enga√±osa.", right:"Menos interrupciones y sanciones." }
      },
      {
        title: "No dotar insumos (cuerdas/arneses)",
        subtitle: "¬øConsecuencias econ√≥micas por no dotar insumos de altura?",
        media: { ok: "empleadores35.png", bad: "empleadores36.png" },
        options: [
          { text:"Ninguna.", feedbackIncorrect:"Aumenta riesgo y gastos." },
          { text:"Accidentes, sanciones y primas m√°s altas.", correct:true, feedbackCorrect:"Hasta Bs 40,000 en sanciones." },
          { text:"Pueden improvisar.", feedbackIncorrect:"Improvisaci√≥n incrementa siniestros." },
          { text:"Solo calidad, no rentabilidad.", feedbackIncorrect:"Impacta fuertemente costos." }
        ],
        companyImpact:{ wrong:"Riesgo sist√©mico.", right:"Cumplimiento y continuidad." }
      }
    ];

    let idx=0, score=0, skipped=0, wrong=0, answeredCurrent=false;
    let shuffledOptions=[];

    const el = {
      qTitle: document.getElementById('qTitle'),
      qSubtitle: document.getElementById('qSubtitle'),
      form: document.getElementById('optForm'),
      next: document.getElementById('nextBtn'),
      skip: document.getElementById('skipBtn'),
      feedback: document.getElementById('feedback'),
      video: document.getElementById('qVideo'),
      qCounter: document.getElementById('qCounter'),
      scorePill: document.getElementById('scorePill'),
      skipsPill: document.getElementById('skipsPill'),
      progress: document.getElementById('progressFill'),
      results: document.getElementById('results'),
      qCard: document.getElementById('qCard'),
      mCorrect: document.getElementById('mCorrect'),
      mWrong: document.getElementById('mWrong'),
      mSkipped: document.getElementById('mSkipped'),
      mPercent: document.getElementById('mPercent'),
      mHint: document.getElementById('mHint'),
      restart: document.getElementById('restartBtn'),
      img: document.getElementById('qImage'),
      imgWrap: document.getElementById('imgWrap'),
      openFullBtn: document.getElementById('openFullBtn'),
      downloadImg: document.getElementById('downloadImg'),
      imgModal: document.getElementById('imgModal'),
      modalImg: document.getElementById('modalImg'),
      closeModal: document.getElementById('closeModal'),
    };

    function renderQuestion(){
      const q=questions[idx];
      answeredCurrent=false;
      el.video.pause(); el.video.currentTime=0; el.video.style.display='none'; el.video.removeAttribute('src');
      el.imgWrap.style.display='none'; el.img.style.display='none'; el.img.removeAttribute('src');
      el.feedback.style.display='none'; el.feedback.textContent=''; el.feedback.className='feedback';
      el.qTitle.textContent=q.title;
      el.qSubtitle.textContent=q.subtitle||'';
      shuffledOptions = shuffle(q.options).map((o,i)=>({...o,_i:i}));
      el.form.innerHTML='';
      shuffledOptions.forEach((opt,i)=>{
        const lab=document.createElement('label');
        lab.className='opt';
        lab.innerHTML = `<input type="radio" name="opt" value="${i}"><div><strong>${String.fromCharCode(65+i)})</strong> ${opt.text}</div>`;
        el.form.appendChild(lab);
      });
      el.qCounter.textContent=`Pregunta ${idx+1}/${questions.length}`;
      el.progress.style.width=(idx/questions.length)*100 + '%';
      el.next.textContent='Siguiente';
      el.next.disabled=false;
    }

    function checkAndShow(){
      const sel = el.form.querySelector('input[type="radio"]:checked');
      if(!sel){ alert('Selecciona una opci√≥n o usa "Saltar".'); return false; }
      const choice = parseInt(sel.value,10);
      const chosen = shuffledOptions[choice];
      const isCorrect = !!chosen.correct;
      answeredCurrent = true;
      if(isCorrect){
        score++;
        el.feedback.classList.add('ok');
        el.feedback.innerHTML = `<h4 class="ok">‚úÖ Respuesta correcta</h4><p>${chosen.feedbackCorrect || '¬°Correcto!'}</p>`;
        if(questions[idx].companyImpact?.right){
          el.feedback.innerHTML += `<div class="impact"><p><strong>Impacto empresarial:</strong> ${questions[idx].companyImpact.right}</p></div>`;
        }
        showMedia(questions[idx].media && questions[idx].media.ok);
      }else{
        wrong++;
        el.feedback.classList.add('bad');
        el.feedback.innerHTML = `<h4 class="bad">‚ùå Respuesta incorrecta</h4><p>${chosen.feedbackIncorrect || 'Respuesta incorrecta.'}</p>`;
        if(questions[idx].companyImpact?.wrong){
          el.feedback.innerHTML += `<div class="impact"><p><strong>Impacto empresarial:</strong> ${questions[idx].companyImpact.wrong}</p></div>`;
        }
        showMedia(questions[idx].media && questions[idx].media.bad);
      }
      el.feedback.style.display='block';
      el.form.querySelectorAll('input').forEach(i=>i.disabled=true);
      el.form.querySelectorAll('.opt').forEach(o=>o.classList.add('disabled'));
      el.scorePill.textContent=`Puntaje: ${score}`;
      el.next.textContent = (idx===questions.length-1) ? 'Finalizar' : 'Siguiente';
      return true;
    }

    function resolveMedia(m){
      if(!m) return null;
      if(typeof m === 'string'){
        const ext = m.split('.').pop().toLowerCase();
        const videoTypes = ['mp4','webm','ogg'];
        const imageTypes = ['jpg','jpeg','png','gif','webp','bmp','svg'];
        const type = videoTypes.includes(ext) ? 'video' : (imageTypes.includes(ext) ? 'image' : 'unknown');
        return { type, src: m };
      }
      if(typeof m === 'object' && m.type && m.src) return m;
      return null;
    }

    function showMedia(mediaDescriptor){
      const m = resolveMedia(mediaDescriptor);
      if(!m) return;
      if(m.type === 'video'){
        el.video.src = m.src;
        el.video.style.display = 'block';
        el.video.play().catch(()=>{});
      }else{
        el.img.src = m.src;
        el.imgWrap.style.display='block';
        el.img.style.display='block';
        el.downloadImg.href = m.src;
        el.openFullBtn.onclick = ()=>openModalFull(m.src);
        el.img.onclick = ()=>openModalFull(m.src);
      }
    }

    function openModalFull(src){
      el.modalImg.src = src;
      el.imgModal.style.display = 'flex';
    }
    function closeModalFull(){
      el.imgModal.style.display = 'none';
      el.modalImg.removeAttribute('src');
    }

    function skipQuestion(){ skipped++; el.skipsPill.textContent=`Saltadas: ${skipped}`; goNext(); }
    function goNext(){ if(idx<questions.length-1){ idx++; renderQuestion(); } else { showResults(); } }

    function showResults(){
      el.progress.style.width='100%';
      el.qCard.style.display='none';
      el.results.style.display='block';
      const total=questions.length, percent=Math.round((score/total)*100);
      el.mCorrect.textContent=score;
      el.mWrong.textContent=wrong;
      el.mSkipped.textContent=skipped;
      el.mPercent.textContent=percent+'%';
      let hint='Nivel de capacitaci√≥n: ';
      if(percent>=90) hint+='Excelente ‚úÖ';
      else if(percent>=75) hint+='Adecuado üëç';
      else if(percent>=60) hint+='B√°sico ‚ö†Ô∏è';
      else hint+='Insuficiente ‚ùå';
      el.mHint.textContent=hint;
    }

    el.next.addEventListener('click', ()=>{ if(!answeredCurrent){ if(!checkAndShow()) return; } else { goNext(); } });
    el.skip.addEventListener('click', skipQuestion);
    el.restart.addEventListener('click', ()=>{ 
      idx=0;score=0;skipped=0;wrong=0; 
      el.qCard.style.display='block'; 
      el.results.style.display='none'; 
      el.scorePill.textContent='Puntaje: 0'; 
      el.skipsPill.textContent='Saltadas: 0'; 
      resetearFormularioNombre();
      renderQuestion(); 
    });
    el.closeModal.addEventListener('click', closeModalFull);
    el.imgModal.addEventListener('click', (e)=>{ if(e.target===el.imgModal) closeModalFull(); });
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && el.imgModal.style.display==='flex') closeModalFull(); });

    renderQuestion();
  </script>

  <!-- INTEGRACI√ìN SUPABASE -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL = 'https://cjwocxsfcqllhzhlasuf.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNqd29jeHNmY3FsbGh6aGxhc3VmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIyOTg1MDcsImV4cCI6MjA3Nzg3NDUwN30.B7HYB7nv7cE5sAfRjRTJSGYnRx18cubfroNyet1mt_A';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    function obtenerNombreModulo() {
      const titulo = document.title.toLowerCase();
      if (titulo.includes('empleadores')) return 'Empleadores';
      if (titulo.includes('escaleras')) return 'Escaleras';
      if (titulo.includes('estructuras') || titulo.includes('encofrados')) return 'Estructuras y Encofrados';
      if (titulo.includes('supervisores')) return 'Supervisores';
      if (titulo.includes('andamios')) return 'Andamios';
      if (titulo.includes('cubiertas') || titulo.includes('techos')) return 'Cubiertas y Techos';
      return document.title;
    }

    async function guardarResultadoSupabase() {
      const nombre = document.getElementById('nombreUsuario').value.trim();
      if (!nombre) {
        alert('‚ö†Ô∏è Por favor ingresa tu nombre para guardar el resultado');
        return;
      }

      const btnGuardar = event.target;
      const textoOriginal = btnGuardar.textContent;
      btnGuardar.textContent = '‚è≥ Guardando...';
      btnGuardar.disabled = true;

      const modulo = obtenerNombreModulo();
      const total = questions.length;
      const correcto = score;
      const incorrecto = wrong;
      const saltado = skipped;
      const porcentaje = Math.round((score/total)*100);
      const puntaje = score * 100;

      console.log('Guardando:', { nombre, modulo, puntaje, correcto, incorrecto, saltado, porcentaje });

      const { data, error } = await supabase
        .from('resultados_test')
        .insert([{
          nombre: nombre,
          modulo: modulo,
          puntaje: puntaje,
          correcto: correcto,
          incorrecto: incorrecto,
          saltado: saltado,
          porcentaje: porcentaje
        }]);

      if (error) {
        console.error('Error:', error);
        alert('‚ùå Error al guardar: ' + error.message);
        btnGuardar.textContent = textoOriginal;
        btnGuardar.disabled = false;
      } else {
        document.getElementById('mensajeGuardado').style.display = 'block';
        document.getElementById('mensajeGuardado').textContent = '‚úÖ ¬°Resultado guardado correctamente! Puedes reiniciar para intentar de nuevo.';
        document.getElementById('formNombre').style.display = 'none';
      }
    }

    function resetearFormularioNombre() {
      document.getElementById('formNombre').style.display = 'block';
      document.getElementById('mensajeGuardado').style.display = 'none';
      document.getElementById('nombreUsuario').value = '';
    }
  </script>
</body>
</html>
